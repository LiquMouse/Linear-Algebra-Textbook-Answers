\usepackage{ctex}		%中文
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xcolor}		%颜色
\usepackage{enumitem}
\usepackage[top=3cm,bottom=4cm,left=3cm,right=3cm]{geometry}
\usepackage{titlesec}	%定制标题格式
\usepackage{tocloft}	%用于定制目录格式
\usepackage[bookmarksnumbered=true,hidelinks]{hyperref}	% 目录可点击跳转
\usepackage{arydshln}	%分块矩阵
\usepackage{zhnumber}	%中文编号
\usepackage{graphicx}	%可以镜像文字
\usepackage{fancyhdr}	%页眉页脚
%\usepackage{setspace}
\usepackage{needspace}

%行距
\linespread{1.5}
\lineskip = 0.5em

%页眉页脚(正文)
\renewcommand{\headrulewidth}{1pt} % 线条粗细
\renewcommand{\headrule}{\hbox to\headwidth{\color{myblue}\leaders\hrule height \headrulewidth\hfill}}
\setlength{\headheight}{25pt}
\fancypagestyle{main}[fancy]{
    \fancyhf{}
    \fancyhead[L]{\normalsize v0.4.6 }
    \fancyhead[C]{\normalsize \bf \textcolor{myblue}{线性代数学习辅导·}\textcolor{mygreen}{\leftmark}}
    \fancyhead[R]{\normalsize \bf \textcolor{myblue}{原作: 大数据202 沈同}}
    \fancyfoot[L]{\footnotesize 排版: lsy }
    \fancyfoot[C]{\footnotesize 请以原版手稿为准, 如有错漏请反馈 \par \textcolor{white}{.}\par\scriptsize 发布: \href{https://yunpan.ustb.edu.cn/link/AAACDF27F8DE57475DAD561FCDF2CE2BC7}{\textcolor{myblue}{\underline{https://yunpan.ustb.edu.cn/link/AAACDF27F8DE57475DAD561FCDF2CE2BC7}}}, 提取码: ustb}
    \fancyfoot[R]{\bf \thepage}
}

%页眉页脚(目录)
\fancypagestyle{content}[main]{
    \fancyhead[C]{\normalsize \bf \textcolor{myblue}{线性代数学习辅导·}\textcolor{mygreen}{目录}}
    \fancyfoot[L]{}
    \fancyfoot[C]{\thepage}
    \fancyfoot[R]{}
}

% 重新定义 \sectionmark 以减少页眉标题文字和序号间隔
\makeatletter
\renewcommand{\sectionmark}[1]{%
 \markboth{\thesection\hspace{0.5ex}#1}{}} % 调整为合适的间距
 \makeatother

 %定义反斜省略号
 \newcommand{\iddots}{\reflectbox{$\ddots$}}

 %设置矩阵内的分数形式为tfrac
 \newcommand{\setupmatrixfrac}{%
     \let\frac\tfrac
     \let\dfrac\tfrac
 }
 \AtBeginEnvironment{matrix}{\setupmatrixfrac}
 \AtBeginEnvironment{pmatrix}{\setupmatrixfrac}
 \AtBeginEnvironment{bmatrix}{\setupmatrixfrac}
 \AtBeginEnvironment{Bmatrix}{\setupmatrixfrac}
 \AtBeginEnvironment{vmatrix}{\setupmatrixfrac}
 \AtBeginEnvironment{Vmatrix}{\setupmatrixfrac}
 \AtBeginEnvironment{smallmatrix}{\setupmatrixfrac}
 \AtBeginEnvironment{array}{\setupmatrixfrac}
 \everymath{\displaystyle}

 %颜色设置
 \definecolor{myblue}{RGB}{68, 113, 183}
 \definecolor{mygreen}{RGB}{111, 173, 70}

 %各级标题设置
 \setcounter{secnumdepth}{5} % 确保 paragraph 和 subparagraph 被编号


 %section, 习题x.x
 \renewcommand{\thesection}{习题} %重定义编号
 \titleformat{\section}[block]
 {\normalfont\Large\bfseries\centering}  %正常字体, 特大, 粗体, 居中
 {\thesection}	%编号类型
 {0pt}   %编号与标题文本间距
 {}      %标题前的代码
 \titlespacing*{\section}
 {0pt}   %左端缩进
 {0pt} %段前间距
 {0pt} %标签后


 %subsection, (A), (B), ...
 \renewcommand{\thesubsection}{(\Alph{subsection})} %设置编号为大写字母
 \titleformat{\subsection}[block]
     {\normalfont\large\bfseries\centering} %正常字体, 大, 加粗, 居中
     {\thesubsection}
     {0pt}
     {}
     \titlespacing*{\subsection}{0pt}{0pt}{0pt}

     %paragraph, 题号
     \renewcommand{\theparagraph}{\arabic{paragraph}.} %设置编号为阿拉伯数字加 "."

     \titleformat{\paragraph}
         [hang]
         {\color{myblue}}    %设置成自定义的蓝色
         {\theparagraph}     %编号加"."
         {0.5ex}             %编号后间距
         {}                  %标题前代码不设置
         \titlespacing{\paragraph}{0pt}{0.5em}{0em}


         %subparagraph, 小题号
         \renewcommand{\thesubparagraph}{(\arabic{subparagraph})}
         \titleformat{\subparagraph}
             [runin] %见 titlesec 文档
             {} %不特别设置格式
             {\thesubparagraph}
             {20em}
             {}
             \titlespacing{\subparagraph}{0pt}{0.75em}{1em}

             %目录设置
             % === 为 section 添加点线引导符 ===
             \renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}} % section 用点线
             %\renewcommand{\cftsubsecleader}{\cftdotfill{\cftdotsep}} % subsection 保持点线（默认已有）

             \setlength{\cftsecnumwidth}{2.25em}  %设置目录中section正文到左端的距离
             \renewcommand{\contentsname}{\centerline{目\quad 录}}    %设置目录标题居中且为 "目录"
             \setcounter{tocdepth}{3} % 3 表示到 subsubsection，不包括 paragraph (4)
             \tocloftpagestyle{content}

             \pretocmd{\section}{\needspace{7\baselineskip}}{}{}
 \pretocmd{\subsection}{\needspace{4\baselineskip}}{}{}
     \pretocmd{\subsubsection}{\needspace{4\baselineskip}}{}{}

         % 小题列表
         \setlist[enumerate,1]{
             label=(\arabic*),
             left=0pt,
             wide=0pt,
             labelsep=0.5em,
             topsep=0.5em,
             itemsep=1ex,
             leftmargin=*,
             align=left
         }